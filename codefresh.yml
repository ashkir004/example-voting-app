version: '1.0'
steps:

  deploy_to_swarm:
    image: ncodefresh/remote-docker:ssh-tunnel
    working_directory: ${{main_clone}}
    commands:
      - rdocker
      - docker stack deploy --compose-file docker-stack.yml ${{STACK_NAME}}
    environment:
      - RDOCKER_HOST=${{RDOCKER_HOST}}
      - SSH_KEY=${{SSH_KEY}}
      - SSH_PORT=${{SSH_PORT}}
    when:
      branch:
        only:
          - ssh-tunnel